<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand -->
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="SpaTopic">
  <title>CellTopic analysis • SpaTopic</title>
  <script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
  <script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
    integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css"
    integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
  <!-- bootstrap-toc -->
  <script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js"
    integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script>
  <!-- headroom.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js"
    integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js"
    integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>
  <!-- clipboard.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"
    integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js"
    integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A=="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js"
    integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg=="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js"
    integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww=="
    crossorigin="anonymous"></script><!-- pkgdown -->
  <script src="../pkgdown.js"></script>
  <meta property="og:title" content="CellTopic analysis">
  <meta property="og:description" content="SpaTopic">
  <!-- mathjax -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"
    integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js"
    integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>

<body>
  <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


  <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light">
    <div class="container">

      <a class="navbar-brand me-2" href="../index.html">SpaTopic</a>

      <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom"
        title="">0.1.0</small>


      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar"
        aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div id="navbar" class="collapse navbar-collapse ms-3">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" href="../reference/index.html">Reference</a>
          </li>
          <li class="active nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false"
              aria-haspopup="true" id="dropdown-articles">Articles</a>
            <div class="dropdown-menu" aria-labelledby="dropdown-articles">
              <a class="dropdown-item" href="../articles/CellTopic_analysis.html">CellTopic analysis</a>
              <a class="dropdown-item" href="../articles/Quick_start.html">Quick start</a>
              <a class="dropdown-item" href="../articles/Spatial_expansion.html">Spatial expansion</a>
              <a class="dropdown-item" href="../articles/SpaTopic_workflow.html">SpaTopic workflow</a>
            </div>
          </li>
        </ul>
        <form class="form-inline my-2 my-lg-0" role="search">
          <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input"
            data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
        </form>

        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="external-link nav-link" href="https://github.com/compbioNJU/SpaTopic/" aria-label="github">
              <span class="fab fa fab fa-github fa-lg"></span>

            </a>
          </li>
        </ul>
      </div>


    </div>
  </nav>
  <div class="container template-article">




    <div class="row">
      <main id="main" class="col-md-9">
        <div class="page-header">
          <img src="" class="logo" alt="">
          <h1>CellTopic analysis</h1>


          <small class="dont-index">Source: <a
              href="https://github.com/compbioNJU/SpaTopic/blob/HEAD/vignettes/CellTopic_analysis.Rmd"
              class="external-link"><code>vignettes/CellTopic_analysis.Rmd</code></a></small>
          <div class="d-none name"><code>CellTopic_analysis.Rmd</code></div>
        </div>



        <div class="section level2">
          <h2 id="spatopic">SpaTopic<a class="anchor" aria-label="anchor" href="#spatopic"></a>
          </h2>
          <div class="section level3">
            <h3 id="load-data">Load data<a class="anchor" aria-label="anchor" href="#load-data"></a>
            </h3>
            <div class="sourceCode" id="cb1">
              <pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/compbioNJU/SpaTopic" class="external-link">SpaTopic</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggforce.data-imaginist.com" class="external-link">ggforce</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">pheatmap</span><span class="op">)</span></span>
<span><span class="va">my_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#66b803"</span>, <span class="st">"#E5AA9B"</span>, <span class="st">"#FABD3E"</span>, <span class="st">"#2B8CBE"</span>, <span class="st">"#DE77AE"</span>, <span class="st">"#9970AB"</span>, <span class="st">"gray"</span>, <span class="st">"#D5E4A2"</span>, <span class="st">"#71D0F5"</span>, <span class="st">"#B1746F"</span>, <span class="st">"#ADE2D0"</span>, <span class="st">"#20DE8BFF"</span>, <span class="st">"#CCDE8BFF"</span>, <span class="st">"#FFDE8BFF"</span>, <span class="st">"#FFA88BFF"</span>, <span class="st">"#FF6A8BFF"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"vignette_data/HCC_1L_obj.rda"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"vignette_data/HCC_1L_spot_celltype.rda"</span><span class="op">)</span></span></code></pre>
            </div>
            <p>
              The “HCC_1L_obj” data is a Seurat object that has been normalized
              using <code>SCTransform</code>
              . This data is mentioned in the section on
              &quot;Data and Materials Availability &quot;in our <a
                href="https://www.science.org/doi/10.1126/sciadv.adp4942#sec-4">paper</a>
              . "HCC_1L_obj.rda" data can be downloaded directly from <a
                href="https://drive.google.com/file/d/1FyXskIWzEvfOvEIpQQeByPXsPP5NjR8u/view?usp=drive_link">here</a>.
            </p>
          </div>
          <div class="section level3">
            <h3 id="cluster">cluster<a class="anchor" aria-label="anchor" href="#cluster"></a>
            </h3>
            <p>Here we use the clustering method ‘Seurat’, parameters are as
              follows, the data has been processed by <code>SCTransform</code>.</p>
            <div class="sourceCode" id="cb2">
              <pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HCC_1L_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunPCA.html" class="external-link">RunPCA</a></span><span class="op">(</span><span class="va">HCC_1L_obj</span>, assay <span class="op">=</span> <span class="st">"SCT"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">HCC_1L_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindNeighbors.html" class="external-link">FindNeighbors</a></span><span class="op">(</span><span class="va">HCC_1L_obj</span>, reduction <span class="op">=</span> <span class="st">"pca"</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">HCC_1L_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FindClusters.html" class="external-link">FindClusters</a></span><span class="op">(</span><span class="va">HCC_1L_obj</span>, resolution <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">HCC_1L_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html" class="external-link">RunUMAP</a></span><span class="op">(</span><span class="va">HCC_1L_obj</span>, reduction <span class="op">=</span> <span class="st">"pca"</span>, dims <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span></span></code></pre>
            </div>
            <pre><code>Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck

Number of nodes: 2791
Number of edges: 103726

Running Louvain algorithm...
Maximum modularity in 10 random starts: 0.7420
Number of communities: 16
Elapsed time: 0 seconds</code></pre>
          </div>
          <div class="section level3">
            <h3 id="celltopic">CellTopic<a class="anchor" aria-label="anchor" href="#celltopic"></a>
            </h3>
            <div class="sourceCode" id="cb4">
              <pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HCC_1L_spot_clusters</span> <span class="op">&lt;-</span> <span class="va">HCC_1L_obj</span><span class="op">@</span><span class="va">meta.data</span><span class="op">[</span><span class="st">"seurat_clusters"</span><span class="op">]</span></span>
<span><span class="va">result_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CellTopic.html">CellTopic</a></span><span class="op">(</span></span>
<span>  <span class="va">HCC_1L_spot_celltype</span>,</span>
<span>  <span class="va">HCC_1L_spot_clusters</span>,</span>
<span>  cluster <span class="op">=</span> <span class="st">"seurat_clusters"</span>,</span>
<span>  num_topics <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  percent <span class="op">=</span> <span class="fl">0.7</span></span>
<span><span class="op">)</span></span>
<span><span class="va">HCC_1L_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/AddMetaData.html" class="external-link">AddMetaData</a></span><span class="op">(</span><span class="va">HCC_1L_obj</span>, <span class="va">result_list</span><span class="op">[[</span><span class="st">"CellTopic"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/SpatialPlot.html" class="external-link">SpatialDimPlot</a></span><span class="op">(</span><span class="va">HCC_1L_obj</span>, group.by <span class="op">=</span> <span class="st">"CellTopic"</span>, image.alpha <span class="op">=</span> <span class="fl">0</span>, pt.size.factor <span class="op">=</span> <span class="fl">2.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">my_colors</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/SpatialPlot.html" class="external-link">SpatialDimPlot</a></span><span class="op">(</span><span class="va">HCC_1L_obj</span>, alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre>
            </div>
            <p><img src="CellTopic_analysis_files/figure-html/unnamed-chunk-3-1.png" width="50%"><img
                src="CellTopic_analysis_files/figure-html/unnamed-chunk-3-2.png" width="50%"></p>
          </div>
        </div>
        <div class="section level2">
          <h2 id="special-spatial-domain">Special spatial domain<a class="anchor" aria-label="anchor"
              href="#special-spatial-domain"></a>
          </h2>
          <p>SpaTopic can combine cell types and spatial location of CellTopics to
            analyze certain specialized spatial tissue structures in cancer, such as
            Tertiary Lymphoid Structures (TLSs) and tumor boundary.</p>
          <p>We can see that the slice is divided into 15 CellTopics, of which
            CellTopics 1, 2, 4, and 5 belong to the cancer regions, and their main
            cell types are epithelial cells.</p>
          <div class="sourceCode" id="cb5">
            <pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/CellTopic_plot.html">CellTopic_plot</a></span><span class="op">(</span><span class="va">HCC_1L_obj</span>, </span>
<span>               celltype_topic <span class="op">=</span> <span class="va">result_list</span><span class="op">[[</span><span class="st">"celltype_topic"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>               celltopic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"CellTopic"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               cols.highlight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#DE2D26"</span>, <span class="st">"#FEE0D2"</span><span class="op">)</span>,</span>
<span>               cols.celltype <span class="op">=</span> <span class="va">my_colors</span>, </span>
<span>               pt.size.factor <span class="op">=</span> <span class="fl">2.2</span><span class="op">)</span></span></code></pre>
          </div>
          <p><img src="CellTopic_analysis_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
          <p>CellTopic8 mainly represents the tumor boundary, and its major cell
            types include fibroblast cells, pDC cells and B cells.</p>
          <div class="sourceCode" id="cb6">
            <pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/CellTopic_plot.html">CellTopic_plot</a></span><span class="op">(</span><span class="va">HCC_1L_obj</span>, </span>
<span>               celltype_topic <span class="op">=</span> <span class="va">result_list</span><span class="op">[[</span><span class="st">"celltype_topic"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>               celltopic <span class="op">=</span> <span class="st">"CellTopic8"</span>, </span>
<span>               cols.highlight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#DE2D26"</span>, <span class="st">"#FEE0D2"</span><span class="op">)</span>,</span>
<span>               cols.celltype <span class="op">=</span> <span class="va">my_colors</span>,</span>
<span>               pt.size.factor <span class="op">=</span> <span class="fl">2.2</span><span class="op">)</span></span></code></pre>
          </div>
          <p><img src="CellTopic_analysis_files/figure-html/unnamed-chunk-5-1.png" width="288"></p>
          <p>Additionally, CellTopic 7 is found in the paraneoplastic region,
            predominantly consisting of plasmacytoid dendritic cells (pDCs), B
            cells, and myeloid cells.</p>
          <p>On the right, we observe the scoring for spots using the “<a
              href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8683021/" class="external-link">TLS50</a>”
            gene set, which is considered to be the gene signature for the
            identification of TLSs.</p>
          <div class="sourceCode" id="cb7">
            <pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/CellTopic_plot.html">CellTopic_plot</a></span><span class="op">(</span><span class="va">HCC_1L_obj</span>, </span>
<span>               celltype_topic <span class="op">=</span> <span class="va">result_list</span><span class="op">[[</span><span class="st">"celltype_topic"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>               celltopic <span class="op">=</span> <span class="st">"CellTopic7"</span>, </span>
<span>               cols.highlight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#DE2D26"</span>, <span class="st">"#FEE0D2"</span><span class="op">)</span>,</span>
<span>               cols.celltype <span class="op">=</span> <span class="va">my_colors</span>, </span>
<span>               highlight.circle <span class="op">=</span> <span class="st">"isTLS"</span>,</span>
<span>               pt.size.factor <span class="op">=</span> <span class="fl">2.2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://satijalab.org/seurat/reference/SpatialPlot.html" class="external-link">SpatialFeaturePlot</a></span><span class="op">(</span><span class="va">HCC_1L_obj</span>, features <span class="op">=</span> <span class="st">"scores"</span>, pt.size.factor <span class="op">=</span> <span class="fl">2.2</span>, image.alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"TLS50"</span><span class="op">)</span></span></code></pre>
          </div>
          <p><img src="CellTopic_analysis_files/figure-html/unnamed-chunk-6-1.png" width="50%"><img
              src="CellTopic_analysis_files/figure-html/unnamed-chunk-6-2.png" width="50%"></p>
        </div>
        <div class="section level2">
          <h2 id="meta-analysis">Meta analysis<a class="anchor" aria-label="anchor" href="#meta-analysis"></a>
          </h2>
          <div class="section level3">
            <h3 id="load-data-1">Load data<a class="anchor" aria-label="anchor" href="#load-data-1"></a>
            </h3>
            <p>Presented here is a meta-analysis of the CellTopic-celltypes data
              derived from four primary colorectal cancer cases as well as two
              corresponding metastatic liver cancer instances.</p>
            <div class="sourceCode" id="cb8">
              <pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"vignette_data/Meta_CellTopic.rda"</span><span class="op">)</span></span>
<span><span class="va">Meta_CellTopic</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre>
            </div>
            <pre><code>                  C1_CellTopic1 C1_CellTopic2 C1_CellTopic3 C1_CellTopic4
T01_cycling_TNK      0.01354725   0.022351251   0.022554421   0.017575393
B07_plasma_PPIB      0.02185837   0.018740898   0.018035048   0.006827589
M02_Mac_CXCL9        0.02372333   0.006066737   0.008488789   0.009032274
M08_cycling_MKI67    0.01309684   0.013551056   0.022641684   0.016111530
B04_plasma_IGHG2     0.03035225   0.009415768   0.005488518   0.008393596
                  C1_CellTopic5
T01_cycling_TNK     0.016782494
B07_plasma_PPIB     0.023410894
M02_Mac_CXCL9       0.006921123
M08_cycling_MKI67   0.022835434
B04_plasma_IGHG2    0.024964639</code></pre>
            <p>Initially, we calculate the correlation among the CellTopics. Based
              on the complete clustering outcomes, we identify CellTopics that
              comprise similar cell types and subsequently define these clusters as
              MetaTopics.</p>
            <div class="sourceCode" id="cb10">
              <pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">Meta_CellTopic</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html" class="external-link">pheatmap</a></span><span class="op">(</span><span class="va">corr</span>,</span>
<span>         border_color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>         scale <span class="op">=</span> <span class="st">"none"</span>, </span>
<span>         cluster_rows <span class="op">=</span> <span class="cn">T</span>,</span>
<span>         cluster_cols <span class="op">=</span> <span class="cn">T</span>,</span>
<span>         legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>         show_rownames <span class="op">=</span> <span class="cn">T</span>,</span>
<span>         show_colnames <span class="op">=</span> <span class="cn">T</span>,</span>
<span>         fontsize <span class="op">=</span> <span class="fl">8</span>, </span>
<span>         cutree_rows <span class="op">=</span> <span class="fl">7</span>,</span>
<span>         cutree_cols <span class="op">=</span> <span class="fl">7</span></span>
<span><span class="op">)</span></span></code></pre>
            </div>
            <p><img src="CellTopic_analysis_files/figure-html/unnamed-chunk-8-1.png" width="768"></p>
            <p>Utilizing the Wilcoxon test, we discerned the cell types that exhibit
              high expression for each MetaTopic. The heatmap below displays the mean
              expression of each cell type within each MetaTopic, with the p-values
              indicating the significance of the differences in expression levels.</p>
            <div class="sourceCode" id="cb11">
              <pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span></span>
<span><span class="va">row_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cutree.html" class="external-link">cutree</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">tree_row</span>,k<span class="op">=</span><span class="fl">7</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">row_cluster</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"cluster"</span></span>
<span><span class="va">row_cluster</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"M"</span>, <span class="va">row_cluster</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span>
<span><span class="va">row_cluster</span><span class="op">$</span><span class="va">sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_.*"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">row_cluster</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Meta_CellTopic_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Meta_CellTopic</span><span class="op">)</span><span class="op">)</span>, <span class="va">row_cluster</span>, by <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">Meta_CellTopic_cluster_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">Meta_CellTopic_cluster</span>, id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cluster"</span>, <span class="st">"Row.names"</span>, <span class="st">"sample"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Meta_CellTopic_cluster_long</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cluster"</span>, <span class="st">"CellTopic"</span>, <span class="st">"sample"</span>, <span class="st">"celltype_min"</span>, <span class="st">"value"</span><span class="op">)</span></span>
<span><span class="va">Meta_CellTopic_cluster_long</span><span class="op">$</span><span class="va">CellTopic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">Meta_CellTopic_cluster_long</span><span class="op">$</span><span class="va">CellTopic</span><span class="op">)</span></span>
<span><span class="va">Meta_CellTopic_cluster_long</span><span class="op">$</span><span class="va">celltype_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">Meta_CellTopic_cluster_long</span><span class="op">$</span><span class="va">celltype_min</span><span class="op">)</span></span></code></pre>
            </div>
            <div class="sourceCode" id="cb12">
              <pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">Meta_CellTopic_cluster_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">cluster</span>, <span class="va">celltype_min</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">value</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html" class="external-link">spread</a></span><span class="op">(</span><span class="va">celltype_min</span>, <span class="va">mean</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">column_to_rownames</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"cluster"</span><span class="op">)</span></span></code></pre>
            </div>
            <pre><code> [1m [22m`summarise()` has grouped output by 'cluster'. You can override using the
`.groups` argument.</code></pre>
            <div class="sourceCode" id="cb14">
              <pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Meta_CellTopic_cluster_long</span><span class="op">$</span><span class="va">celltype_min</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">column_to_rownames</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"."</span><span class="op">)</span></span>
<span><span class="va">ct_n</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">ct</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Meta_CellTopic_cluster_long</span><span class="op">$</span><span class="va">celltype_min</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">all</span> <span class="op">&lt;-</span> <span class="va">Meta_CellTopic_cluster_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">celltype_min</span> <span class="op">==</span> <span class="va">ct</span><span class="op">)</span></span>
<span>  <span class="va">cls_n</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">cls</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Meta_CellTopic_cluster_long</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">select</span> <span class="op">&lt;-</span> <span class="va">Meta_CellTopic_cluster_long</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">celltype_min</span> <span class="op">==</span> <span class="va">ct</span> <span class="op">&amp;</span> <span class="va">cluster</span> <span class="op">==</span> <span class="va">cls</span><span class="op">)</span></span>
<span>      <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html" class="external-link">wilcox.test</a></span><span class="op">(</span><span class="va">select</span><span class="op">$</span><span class="va">value</span>, <span class="va">all</span><span class="op">$</span><span class="va">value</span>, alternative <span class="op">=</span> <span class="st">"greater"</span><span class="op">)</span></span>
<span>      <span class="va">p</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">$</span><span class="va">p.value</span></span>
<span>      <span class="va">df_p</span><span class="op">[</span><span class="va">ct_n</span>,<span class="va">cls_n</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p</span></span>
<span>      <span class="va">cls_n</span> <span class="op">&lt;-</span> <span class="va">cls_n</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="va">ct_n</span> <span class="op">&lt;-</span> <span class="va">ct_n</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df_p</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">Meta_CellTopic_cluster_long</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df_pp</span> <span class="op">&lt;-</span> <span class="va">df_p</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">df_pp_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">df_pp</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">0.05</span>, <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"none"</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">df_pp_cluster_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">df_pp_cluster</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">df_pp_cluster</span><span class="op">$</span><span class="va">.</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">df_pp</span> <span class="op">&lt;-</span> <span class="va">df_pp</span><span class="op">[</span>,<span class="va">df_pp_cluster_name</span><span class="op">]</span></span>
<span><span class="va">df_pp_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">df_pp</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">0.05</span>, <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="st">"none"</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">df_pp_cluster</span><span class="op">$</span><span class="va">.</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">df_pp_cluster</span><span class="op">$</span><span class="va">.</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df_pp_cluster</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"high in MetaTopics"</span></span>
<span><span class="va">mycolor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#f94144"</span>, <span class="st">"#f8961e"</span>, <span class="st">"#f7f31c"</span>, <span class="st">"#77bb43"</span>, <span class="st">"#429f9c"</span>, <span class="st">"#3574b8"</span>, <span class="st">"#bb3892"</span>, <span class="st">"grey"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">mycolor</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span>, <span class="st">"6"</span>, <span class="st">"7"</span>, <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span>,<span class="va">df_pp_cluster_name</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/pheatmap/man/pheatmap.html" class="external-link">pheatmap</a></span><span class="op">(</span>border_color <span class="op">=</span> <span class="st">"black"</span>, scale <span class="op">=</span> <span class="st">"none"</span>, legend <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>    cellwidth <span class="op">=</span> <span class="fl">15</span>, cellheight <span class="op">=</span> <span class="fl">15</span>,</span>
<span>    cluster_rows <span class="op">=</span> <span class="cn">F</span>, cluster_cols <span class="op">=</span> <span class="cn">F</span>, </span>
<span>    show_rownames <span class="op">=</span> <span class="cn">T</span>, show_colnames <span class="op">=</span> <span class="cn">T</span>,</span>
<span>    fontsize <span class="op">=</span> <span class="fl">8</span>, fontsize_number <span class="op">=</span> <span class="fl">9</span>, number_color <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>    display_numbers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df_pp</span> <span class="op">&lt;=</span> <span class="fl">0.05</span>, <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df_pp</span> <span class="op">&lt;=</span> <span class="fl">0.01</span>, <span class="st">"***"</span>, <span class="st">"*"</span><span class="op">)</span>, <span class="st">""</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df_pp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    gaps_row <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>,<span class="fl">16</span>,<span class="fl">21</span>,<span class="fl">25</span>,<span class="fl">34</span>,<span class="fl">45</span>,<span class="fl">56</span><span class="op">)</span>,</span>
<span>    annotation_row <span class="op">=</span> <span class="va">df_pp_cluster</span>,</span>
<span>    annotation_colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>`high in MetaTopics` <span class="op">=</span> <span class="va">mycolor</span><span class="op">)</span>,</span>
<span>    angle_col <span class="op">=</span> <span class="fl">90</span></span>
<span>  <span class="op">)</span></span></code></pre>
            </div>
            <p><img src="CellTopic_analysis_files/figure-html/unnamed-chunk-10-1.png" width="480"></p>
          </div>
        </div>
        <div class="section level2">
          <h2 id="cell-cell-communication">Cell-Cell communication<a class="anchor" aria-label="anchor"
              href="#cell-cell-communication"></a>
          </h2>
          <p>We can delve deeper into the complexities of the tumor
            microenvironment by analyzing the communication among different
            CellTopics. Employ the <a href="https://github.com/jinworks/CellChat" class="external-link">CellChat</a>
            tool to
            elucidate the dynamics of cell communication across spatial domains.</p>
          <div class="section level3">
            <h3 id="load-data-2">load data<a class="anchor" aria-label="anchor" href="#load-data-2"></a>
            </h3>
            <div class="sourceCode" id="cb15">
              <pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"spot_celltype"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"spot_clusters"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"vignette_data/PDAC_obj.rda"</span><span class="op">)</span></span>
<span><span class="va">result_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CellTopic.html">CellTopic</a></span><span class="op">(</span><span class="va">spot_celltype</span>, <span class="va">spot_clusters</span>, cluster <span class="op">=</span> <span class="st">"spatial.cluster"</span>, num_topics <span class="op">=</span> <span class="fl">13</span><span class="op">)</span></span>
<span><span class="va">PDAC_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/AddMetaData.html" class="external-link">AddMetaData</a></span><span class="op">(</span><span class="va">PDAC_obj</span>, <span class="va">result_list</span><span class="op">[[</span><span class="st">"CellTopic"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre>
            </div>
            <div class="sourceCode" id="cb16">
              <pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">CellChat</span><span class="op">)</span></span>
<span><span class="co"># Create cellchat object</span></span>
<span><span class="va">data.input</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SeuratObject/man/AssayData.html" class="external-link">GetAssayData</a></span><span class="op">(</span><span class="va">PDAC_obj</span>, assay <span class="op">=</span> <span class="st">"Spatial"</span>, slot <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span>
<span><span class="va">identity</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>group <span class="op">=</span><span class="va">PDAC_obj</span><span class="op">$</span><span class="va">CellTopic</span>, row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">PDAC_obj</span><span class="op">$</span><span class="va">CellTopic</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cellchat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CellChat/man/createCellChat.html" class="external-link">createCellChat</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">data.input</span>, meta <span class="op">=</span> <span class="va">identity</span>, group.by <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span>
<span><span class="co"># Selective ligand receptor database</span></span>
<span><span class="va">cellchat</span><span class="op">@</span><span class="va">DB</span> <span class="op">&lt;-</span> <span class="va">CellChatDB.human</span></span>
<span><span class="va">cellchat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CellChat/man/subsetData.html" class="external-link">subsetData</a></span><span class="op">(</span><span class="va">cellchat</span><span class="op">)</span></span>
<span><span class="co"># Calculation</span></span>
<span><span class="va">cellchat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CellChat/man/identifyOverExpressedGenes.html" class="external-link">identifyOverExpressedGenes</a></span><span class="op">(</span><span class="va">cellchat</span><span class="op">)</span></span>
<span><span class="va">cellchat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CellChat/man/identifyOverExpressedInteractions.html" class="external-link">identifyOverExpressedInteractions</a></span><span class="op">(</span><span class="va">cellchat</span><span class="op">)</span></span>
<span><span class="va">cellchat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CellChat/man/projectData.html" class="external-link">projectData</a></span><span class="op">(</span><span class="va">cellchat</span>, <span class="va">PPI.human</span><span class="op">)</span></span>
<span><span class="co">#cellchat &lt;- filterCommunication(cellchat, min.cells = 10) # Do not filter spot</span></span>
<span><span class="va">cellchat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CellChat/man/computeCommunProb.html" class="external-link">computeCommunProb</a></span><span class="op">(</span><span class="va">cellchat</span>, raw.use <span class="op">=</span> <span class="cn">FALSE</span>, population.size <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">cellchat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CellChat/man/computeCommunProbPathway.html" class="external-link">computeCommunProbPathway</a></span><span class="op">(</span><span class="va">cellchat</span><span class="op">)</span></span>
<span><span class="va">df.net</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CellChat/man/subsetCommunication.html" class="external-link">subsetCommunication</a></span><span class="op">(</span><span class="va">cellchat</span><span class="op">)</span></span></code></pre>
            </div>
            <pre><code>[1] "Create a CellChat object from a data matrix"
Set cell identities for the new CellChat object 
The cell groups used for CellChat analysis are  CellTopic1 CellTopic2 CellTopic3 CellTopic4 
triMean is used for calculating the average gene expression per cell group. 
[1] "&gt;&gt;&gt; Run CellChat on sc/snRNA-seq data &lt;&lt;&lt; [2024-06-16 18:20:44.033752]"
[1] "&gt;&gt;&gt; CellChat inference is done. Parameter values are stored in `object@options$parameter` &lt;&lt;&lt; [2024-06-16 18:21:27.304678]"</code></pre>
            <p>Communication between different spatial domains from the perspective
              of pathway.</p>
            <div class="sourceCode" id="cb18">
              <pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df.netp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CellChat/man/subsetCommunication.html" class="external-link">subsetCommunication</a></span><span class="op">(</span><span class="va">cellchat</span>, slot.name <span class="op">=</span> <span class="st">"netP"</span><span class="op">)</span></span>
<span><span class="va">df.netp</span><span class="op">$</span><span class="va">sTot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">df.netp</span><span class="op">$</span><span class="va">source</span>, <span class="st">" -&gt; "</span>, <span class="va">df.netp</span><span class="op">$</span><span class="va">target</span><span class="op">)</span></span>
<span><span class="va">df.netp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">df.netp</span>, <span class="va">sTot</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CellTopic1 -&gt; CellTopic1"</span>,<span class="st">"CellTopic1 -&gt; CellTopic2"</span>,<span class="st">"CellTopic1 -&gt; CellTopic3"</span>,<span class="st">"CellTopic1 -&gt; CellTopic4"</span>,<span class="st">"CellTopic2 -&gt; CellTopic1"</span>,<span class="st">"CellTopic3 -&gt; CellTopic1"</span>,<span class="st">"CellTopic4 -&gt; CellTopic1"</span>,<span class="st">"CellTopic2 -&gt; CellTopic4"</span>,<span class="st">"CellTopic4 -&gt; CellTopic2"</span>,<span class="st">"CellTopic2 -&gt; CellTopic2"</span>,<span class="st">"CellTopic3 -&gt; CellTopic3"</span>,<span class="st">"CellTopic4 -&gt; CellTopic4"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df.netp</span><span class="op">$</span><span class="va">sTot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">df.netp</span><span class="op">$</span><span class="va">sTot</span>,levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CellTopic2 -&gt; CellTopic4"</span>,<span class="st">"CellTopic4 -&gt; CellTopic2"</span>,<span class="st">"CellTopic1 -&gt; CellTopic2"</span>,<span class="st">"CellTopic2 -&gt; CellTopic1"</span>,<span class="st">"CellTopic1 -&gt; CellTopic3"</span>,<span class="st">"CellTopic3 -&gt; CellTopic1"</span>,<span class="st">"CellTopic1 -&gt; CellTopic4"</span>,<span class="st">"CellTopic4 -&gt; CellTopic1"</span>,<span class="st">"CellTopic1 -&gt; CellTopic1"</span>,<span class="st">"CellTopic2 -&gt; CellTopic2"</span>,<span class="st">"CellTopic3 -&gt; CellTopic3"</span>,<span class="st">"CellTopic4 -&gt; CellTopic4"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df.netp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">df.netp</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span><span class="op">)</span>, </span>
<span>    target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span><span class="op">)</span>, </span>
<span>    pathway_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VTN"</span>,<span class="st">"VTN"</span>,<span class="st">"VTN"</span><span class="op">)</span>, <span class="co"># It's just for showing the parts without communication, "VTN" has no particularity.</span></span>
<span>    prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, </span>
<span>    pval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span><span class="op">)</span>, </span>
<span>    sTot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CellTopic1 -&gt; CellTopic2"</span>,<span class="st">"CellTopic2 -&gt; CellTopic1"</span>,<span class="st">"CellTopic3 -&gt; CellTopic1"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">'RColorBrewer'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df.netp</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">sTot</span>, y<span class="op">=</span><span class="va">pathway_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size<span class="op">=</span><span class="va">pval</span>, color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df.netp</span><span class="op">$</span><span class="va">pval</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">df.netp</span><span class="op">$</span><span class="va">pval</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p&lt;0.01"</span>,<span class="st">"0.01&lt;p&lt;0.05"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_distiller</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Spectral"</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"low"</span>,<span class="st">"high"</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">df.netp</span><span class="op">$</span><span class="va">prob</span><span class="op">[</span><span class="va">df.netp</span><span class="op">$</span><span class="va">prob</span><span class="op">!=</span><span class="fl">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df.netp</span><span class="op">$</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"p-value"</span>, color <span class="op">=</span> <span class="st">"Commun.prob"</span><span class="op">)</span></span></code></pre>
            </div>
            <p><img src="CellTopic_analysis_files/figure-html/unnamed-chunk-13-1.png" width="384"></p>
          </div>
        </div>
      </main>
      <aside class="col-md-3">
        <nav id="toc">
          <h2>On this page</h2>
        </nav>
      </aside>
    </div>



    <footer>
      <div class="pkgdown-footer-left">
        <p></p>
        <p>Developed by Yuelei Zhang.</p>
      </div>

      <div class="pkgdown-footer-right">
        <p></p>
        <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
      </div>

    </footer>
  </div>





</body>

</html>